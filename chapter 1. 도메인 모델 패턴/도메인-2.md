# 도메인
## 도메인 모델 도출
도메인을 모델링할 때 기본이 되는 작업은 모델을 구성하는 핵심 구성요소, 규칙, 기능을 찾는 것.  
주문 도메인과 관련된 몇 가지 요구사항을 보자.  
1. 최소 한 종류 이상의 상품을 주문해야 한다.
2. 한 상품을 한 개 이상 주문할 수 있다.
3. 총 주문 금액은 각 상품의 구매 가격 합을 모두 더한 금액이다.
4. 각 상품의 구매 가격 합은 상품 가격에 구매 개수를 곱한 값이다.
5. 주문할 때 배송지 정보를 반드시 지정해야 한다.
6. 배송지 정보는 받는 사람 이름, 전화번호, 주소로 구성된다.
7. 출고를 하면 배송지를 변경할 수 없다.
8. 출고 전에 주문을 취소할 수 있다.
9. 고객이 결제를 완료하기 전에는 상품을 준비하지 않는다.

아직 상세 구현까지 할 수 있는 수준은 아니지만 Order에 관련 메서드를 추가할 수 있다.  
```
class Order {
    fun changeShipped() {}
    fun changeShippingInfo(newShippingInfo: ShippingInfo){}
    fun cancel(){}
    fun completePayment(){}
}
```

2, 4 번 요구사항에 따르면 주문항목을 표현하는 OrderLine은 적어도 주문할 상품, 상품의 가격, 구매 개수를 포함해야한다.  
추가로 각 구매 항목의 구매 가격도 제공해야 한다.  

```
class OrderLine(
    private val product: Product,
    private val price: Int,
    private val quantity: Int,
    private val amounts: Int
) {
    fun calculateAmounts() = price * quantity
    
    fun getAmounts(): Int {}
}
```
orderLine은 한 상품(product)를 얼마에 몇 개 살지를 담고 있고 구매 가격을 구하는 로직을 구현하고 있다.  

1, 3번 요구사항은 Order와 OrderLine의 관계를 보여준다.  
한 종류 이상의 상품을 주문할 수 있으므로 Order는 최소 한 개 이상의 OrderLine을 포함해야한다.  
또한 총 주문 금액은 OrderLine에서 구할 수 있다.  
두 요구사항은 Order에 다음과 같이 구현할 수 있다.  
```
class Order(


) {
    private var orderLines: List<OrderLine> = listOf()
    private lateinit var totalAmounts: Money

    private fun setOrderLines(orderLines: List<OrderLine>) {
        verifyAtLeastOneOrMoreOrderLines(orderLines)
        this.orderLines = orderLines
    }

    private fun verifyAtLeastOneOrMoreOrderLines(orderLines: List<OrderLine>): Unit =
        orderLines.takeIf { it.isEmpty() }.run { throw IllegalArgumentException("no OrderLine") }


    private fun calculateTotalAmounts() {
        val sum = orderLines.map { it.getAmounts() }.sum()
        totalAmounts = Money(sum)
    }
```

주문과 관련된 요구사항에서 도메인 모델을 점진적으로 만들어 나갔다.  
일부는 구현수준까지 만들었고, 일부는 이름 정도만 결정했다.  


